# 构建模型

## 流程

### ** 1.数据预处理**

- **删除无关特征**：如小区名称。
- **处理时间特征特征**：将时间转化为竣工时间，再进行后续处理。
- **处理缺失值**：根据地理学第一定律，社区有缺失特征的可以利用最近邻社区对应特征填补。
- **特征选择**：（暂时未做）
- **标准化**
- **划分训练集、测试集、验证集**

## 划分训练集、测试集、验证集的方法

### **1. 数据划分的核心思路**
- **目标**：训练模型捕捉未发生火灾社区（标签0）的“正常”模式，检测潜在隐患（异常点）。
- **关键挑战**：标签0样本（1164个）远多于标签1样本（61个），需合理利用有限的标签1样本评估模型对隐患的识别能力。

---

### **2. 具体划分方案**
#### **(1) 训练集**
- **用途**：仅包含标签0的样本，用于训练模型学习“正常社区”的分布。
- **比例建议**：随机抽取 **80%的标签0样本**（约1164×0.8≈931个）。
- **注意事项**：确保训练数据不包含任何标签1样本，避免污染正常模式学习。

#### **(2) 验证集**
- **用途**：调整模型参数（如 `nu`, `gamma`），评估对隐患的敏感性和误报率。
- **组成建议**：
  - **剩余20%的标签0样本**（1164-931≈233个）。
  - **随机抽取30%的标签1样本**（61×0.3≈18个）作为已知隐患。
- **注意事项**：验证集需包含少量标签1样本，帮助选择能识别隐患的模型参数。

#### **(3) 测试集**
- **用途**：最终评估模型性能，模拟真实场景下的隐患检测能力。
- **组成建议**：
  - **所有未使用的标签0样本**（若验证集已用完剩余标签0样本，可复用部分标签0样本，需确保无重叠）。
  - **剩余70%的标签1样本**（61-18≈43个）作为真实隐患。
- **注意事项**：测试集应完全独立于训练和验证过程，避免数据泄漏。

---

### **3. 代码示例（Python）**
```python
import numpy as np
from sklearn.model_selection import train_test_split

# 假设 X_0 是标签0的特征矩阵，X_1 是标签1的特征矩阵
# 划分训练集（标签0）
X0_train, X0_test_valid = train_test_split(X_0, test_size=0.2, random_state=42)

# 划分验证集和测试集中的标签0
X0_val, X0_test = train_test_split(X0_test_valid, test_size=0.5, random_state=42)

# 划分标签1样本用于验证和测试
X1_val, X1_test = train_test_split(X_1, test_size=0.7, random_state=42)

# 合并验证集和测试集
X_val = np.concatenate([X0_val, X1_val])
y_val = np.concatenate([np.zeros(len(X0_val)), np.ones(len(X1_val))])

X_test = np.concatenate([X0_test, X1_test])
y_test = np.concatenate([np.zeros(len(X0_test)), np.ones(len(X1_test))])
```

---

### **4. 关键注意事项**
1. **类别不平衡处理**：标签1样本极少，需通过分层抽样确保验证/测试集中包含足够隐患样本。
2. **评估指标选择**：
   - **召回率（Recall）**：模型对真实隐患（标签1）的识别能力。
   - **误报率（False Positive Rate）**：将正常社区误判为隐患的比例。
   - **F1 Score**：平衡召回率和精确率的综合指标。
3. **模型调参**：通过验证集的标签1样本优化 `nu`（控制异常点比例）和核函数参数。
4. **重复实验**：因数据量小，建议多次随机划分取平均结果，增强稳定性。

---

### **5. 潜在优化方向**
- **半监督学习**：若部分标签0社区实际存在隐患（但未被标记），可结合少量人工审核优化标签。
- **特征工程**：分析火灾相关特征（如电路老化率、消防通道密度），提升隐患检测可解释性。

---

# 模型评价

### **1. 核心权衡：召回率 vs. 误报率**
- **召回率（Recall）**：  
  - **定义**：异常样本（标签1）中被正确检测的比例（如：火灾隐患社区中被模型识别的比例）。  
  - **重要性**：若漏检隐患后果严重（如火灾导致人员伤亡），需优先追求高召回率（如 >80%）。  

- **误报率（FPR）**：  
  - **定义**：正常样本（标签0）中被误判为异常的比例（如：安全社区被误认为有隐患的比例）。  
  - **重要性**：若误报成本高（如频繁派消防队检查安全社区浪费资源），需压低误报率（如 <10%）。  

**两者本质是矛盾的**：提高召回率通常会导致误报率上升，需根据业务目标权衡。

---

### **2. 参考范围与场景示例**
#### **（1）高风险场景（如火灾、医疗诊断）**
- **优先级**：召回率 > 误报率。  
- **目标值**：  
  - 召回率 ≥80%（宁可误报，不可漏报）  
  - 误报率 ≤20%（若资源允许）  

#### **（2）低风险场景（如广告推荐、网络流量监控）**
- **优先级**：误报率 > 召回率。  
- **目标值**：  
  - 召回率 ≥50%  
  - 误报率 ≤5%（避免干扰正常业务）  

#### **（3）一般工业场景（如设备故障检测）**
- **平衡策略**：F1 Score最大化。  
- **目标值**：  
  - 召回率 60%~80%  
  - 误报率 5%~15%  

